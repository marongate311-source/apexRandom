<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Apex Legends 縛りルーレット</title>
<style>
  body { font-family:sans-serif; background:#222; color:#fff; margin:0; text-align:center; }
  .roulette { margin:20px 0; border-top:1px solid #555; padding-top:10px; }
  .result { font-size:24px; font-weight:bold; margin-top:10px; min-height:30px; }
  img { max-width:150px; margin-top:10px; display:none; }
  select:disabled { opacity:0.5; }
  .filters { margin-top:10px; }
  .filters label { margin-right:10px; }
</style>
</head>
<body>

<h1>Apex Legends 縛りルーレット</h1>

<!-- キャラクター -->
<div class="roulette" id="charRoulette">
  <h3>キャラクター</h3>
  <label><input type="checkbox" id="charOn" checked> 有効</label>
  <label><input type="checkbox" id="charFixedCheck"> 固定化</label>
  <select id="charFixedSelect" disabled></select>
  <div class="result" id="charResult">-</div>
  <img id="charImage" src="" alt="">
</div>

<!-- 武器1 -->
<div class="roulette" id="weapon1Roulette">
  <h3>武器①</h3>
  <label><input type="checkbox" id="weapon1On" checked> 有効</label>
  <label><input type="checkbox" id="weapon1FixedCheck"> 固定化</label>
  <select id="weapon1FixedSelect" disabled></select>
  <div class="filters">
    <label><input type="checkbox" id="weapon1Hard"> 難易度アップ(ケアパケ追加)</label>
    <span>武器種:</span>
    <label><input type="checkbox" value="AR" class="weapon1Type">AR</label>
    <label><input type="checkbox" value="SMG" class="weapon1Type">SMG</label>
    <label><input type="checkbox" value="LMG" class="weapon1Type">LMG</label>
    <label><input type="checkbox" value="HG" class="weapon1Type">HG</label>
    <label><input type="checkbox" value="SG" class="weapon1Type">SG</label>
    <label><input type="checkbox" value="SR" class="weapon1Type">SR</label>
    <label><input type="checkbox" value="MR" class="weapon1Type">MR</label>
    <span>弾種:</span>
    <label><input type="checkbox" value="ライト" class="weapon1Ammo">ライト</label>
    <label><input type="checkbox" value="ヘビー" class="weapon1Ammo">ヘビー</label>
    <label><input type="checkbox" value="特殊" class="weapon1Ammo">特殊</label>
  </div>
  <div class="result" id="weapon1Result">-</div>
  <img id="weapon1Image" src="" alt="">
</div>

<!-- 武器2 -->
<div class="roulette" id="weapon2Roulette">
  <h3>武器②</h3>
  <label><input type="checkbox" id="weapon2On" checked> 有効</label>
  <label><input type="checkbox" id="weapon2FixedCheck"> 固定化</label>
  <select id="weapon2FixedSelect" disabled></select>
  <div class="filters">
    <label><input type="checkbox" id="weapon2Hard"> 難易度アップ(ケアパケ追加)</label>
    <span>武器種:</span>
    <label><input type="checkbox" value="AR" class="weapon2Type">AR</label>
    <label><input type="checkbox" value="SMG" class="weapon2Type">SMG</label>
    <label><input type="checkbox" value="LMG" class="weapon2Type">LMG</label>
    <label><input type="checkbox" value="HG" class="weapon2Type">HG</label>
    <label><input type="checkbox" value="SG" class="weapon2Type">SG</label>
    <label><input type="checkbox" value="SR" class="weapon2Type">SR</label>
    <label><input type="checkbox" value="MR" class="weapon2Type">MR</label>
    <span>弾種:</span>
    <label><input type="checkbox" value="ライト" class="weapon2Ammo">ライト</label>
    <label><input type="checkbox" value="ヘビー" class="weapon2Ammo">ヘビー</label>
    <label><input type="checkbox" value="特殊" class="weapon2Ammo">特殊</label>
  </div>
  <div class="result" id="weapon2Result">-</div>
  <img id="weapon2Image" src="" alt="">
</div>

<!-- 武器3（特定キャラ） -->
<div class="roulette" id="weapon3Roulette" style="display:none;">
  <h3>武器③（特定キャラ）</h3>
  <label><input type="checkbox" id="weapon3On" checked> 有効</label>
  <label><input type="checkbox" id="weapon3FixedCheck"> 固定化</label>
  <select id="weapon3FixedSelect" disabled></select>
  <div class="filters">
    <label><input type="checkbox" id="weapon3Hard"> 難易度アップ(ケアパケ追加)</label>
    <span>武器種:</span>
    <label><input type="checkbox" value="AR" class="weapon3Type">AR</label>
    <label><input type="checkbox" value="SMG" class="weapon3Type">SMG</label>
    <label><input type="checkbox" value="LMG" class="weapon3Type">LMG</label>
    <label><input type="checkbox" value="HG" class="weapon3Type">HG</label>
    <label><input type="checkbox" value="SG" class="weapon3Type">SG</label>
    <label><input type="checkbox" value="SR" class="weapon3Type">SR</label>
    <label><input type="checkbox" value="MR" class="weapon3Type">MR</label>
    <span>弾種:</span>
    <label><input type="checkbox" value="ライト" class="weapon3Ammo">ライト</label>
    <label><input type="checkbox" value="ヘビー" class="weapon3Ammo">ヘビー</label>
    <label><input type="checkbox" value="特殊" class="weapon3Ammo">特殊</label>
  </div>
  <div class="result" id="weapon3Result">-</div>
  <img id="weapon3Image" src="" alt="">
</div>

<button onclick="rollAll()">Let’s GO!!</button>

<script>
  // ===== クラス定義 =====
  class Character {
    constructor(name, gender, role, image){
      this.name = name; this.gender = gender; this.role = role; this.image = image;
    }
  }
  class Weapon {
    constructor(name, type, ammo, isCarePackage, image){
      this.name=name; this.type=type; this.ammo=ammo; this.isCarePackage=isCarePackage; this.image=image;
    }
  }

  // ===== データ =====
  const specialChar = "ランパート";
  const characters = [
    new Character("レイス","女","アタッカー","images/wraith.png"),
    new Character("ジブラルタル","男","タンク","images/gibraltar.png"),
    new Character("ランパート","女","防衛","images/rampart.png"),
    new Character("バンガロール","女","アタッカー","images/bangalore.png"),
  ];
  const weapons = [
    new Weapon("R-301","AR","ライト",false,"images/r301.png"),
    new Weapon("R-99","SMG","ライト",false,"images/r99.png"),
    new Weapon("VK-47","AR","ヘビー",false,"images/vk47.png"),
    new Weapon("プラウラー","SMG","ヘビー",false,"images/plrowler.png"),
    new Weapon("クレーバー","SR","特殊",true,"images/kraber.png"),
  ];

  // ===== 初期化 =====
  function initSelect(selectId, dataList){
    const select = document.getElementById(selectId);
    dataList.forEach(d=>{
      const option = document.createElement("option");
      option.value = d.name; option.textContent = d.name;
      select.appendChild(option);
    });
  }

  window.onload = ()=>{
    ["char","weapon1","weapon2","weapon3"].forEach(type=>{
      initSelect(type+"FixedSelect",(type==="char")?characters:weapons);
      document.getElementById(type+"FixedCheck").addEventListener("change",(e)=>{
        document.getElementById(type+"FixedSelect").disabled = !e.target.checked;
      });
    });
  };

  // ===== フィルター取得 =====
  function getFilteredWeapons(type){
    let list = weapons.slice(); // コピー
    const hardBox = document.getElementById(type+"Hard");
    if(hardBox && hardBox.checked){
      // ケアパケ武器を重複なく追加
      weapons.filter(w=>w.isCarePackage).forEach(w=>{
        if(!list.includes(w)) list.push(w);
      });
    }

    // 武器種・弾種フィルター
    const typeFilters = Array.from(document.querySelectorAll("."+type+"Type:checked")).map(i=>i.value);
    const ammoFilters = Array.from(document.querySelectorAll("."+type+"Ammo:checked")).map(i=>i.value);

    if(typeFilters.length>0) list = list.filter(w=>typeFilters.includes(w.type));
    if(ammoFilters.length>0) list = list.filter(w=>ammoFilters.includes(w.ammo));

    if(list.length === 0){
      alert(type+"の条件に合致する武器が存在しません。設定を見直してください。");
      return null;
    }
    return list;
  }

  // ===== 全ルーレット回す =====
  function rollAll(){
    ["char","weapon1","weapon2","weapon3"].forEach(type=>roll(type));
  }

  // ===== 個別ルーレット =====
  function roll(type){
    if(!document.getElementById(type+"On").checked) return;

    const fixedCheck = document.getElementById(type+"FixedCheck").checked;
    const fixedSelect = document.getElementById(type+"FixedSelect");
    const resultSpan = document.getElementById(type+"Result");
    const imgEl = document.getElementById(type+"Image");

    let list = (type==="char") ? characters : getFilteredWeapons(type);
    if(list===null) return; // 候補なしなら中止

    // アニメーション
    let i=0;
    const anim = setInterval(()=>{
      const choice = list[i%list.length];
      resultSpan.innerText = choice.name;
      imgEl.src = choice.image;
      imgEl.style.display="block";
      i++;
    },100);

    setTimeout(()=>{
      clearInterval(anim);
      let finalChoice = fixedCheck ? list.find(w=>w.name===fixedSelect.value)
                                   : list[Math.floor(Math.random()*list.length)];
      resultSpan.innerText = finalChoice.name;
      imgEl.src = finalChoice.image;

      if(type==="char"){
        document.getElementById("weapon3Roulette").style.display = (finalChoice.name===specialChar)?"block":"none";
      }
    },2000);
  }

</script>
</body>
</html>
