<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Apex Legends 縛りルーレット</title>
<style>
  body { font-family:sans-serif; background:#222; color:#fff; margin:0; text-align:center; }
  h1 { margin-top:20px; }
  .roulette { margin:20px 0; padding:10px; border-top:1px solid #555; }
  .result { font-size:24px; font-weight:bold; margin-top:10px; min-height:30px; }
  .result.active { color: yellow; }
  img { max-width:80%; height:auto; margin-top:10px; display:none; }
  select:disabled { opacity:0.5; }
  .filters { display:flex; flex-wrap:wrap; justify-content:center; margin-top:10px; }
  .filters label, .filters span { margin:5px; }
  button { font-size:18px; padding:10px 20px; cursor:pointer; margin-top:10px; }
  .overlay {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.85); display:flex; justify-content:center; align-items:center;
    z-index: 1000; flex-direction: column; color:#fff; text-align:center;
  }
  .close-btn { cursor:pointer; padding:10px 20px; background:#555; border:none; color:#fff; font-size:18px; margin-top:20px; }
  @media screen and (max-width: 600px) {
    .result { font-size:18px; }
    button, .close-btn { font-size:16px; padding:8px 15px; }
  }
</style>
</head>
<body>

<!-- 注意書きオーバーレイ -->
<div class="overlay" id="overlay">
  <p>※ルーレットを回す前に必ず注意事項を確認してください。</p>
  <label><input type="checkbox" id="dontShow"> 今後表示しない</label><br>
  <button class="close-btn" id="closeOverlay">× 閉じる</button>
</div>

<h1>Apex Legends 縛りルーレット</h1>

<!-- キャラクター -->
<div class="roulette" id="charRoulette">
  <h3>キャラクター</h3>
  <label><input type="checkbox" id="charOn" checked> 有効</label>
  <label><input type="checkbox" id="charFixedCheck"> 固定化</label>
  <select id="charFixedSelect" disabled></select>
  <div class="result" id="charResult">-</div>
  <img id="charImage" src="" alt="">
</div>

<!-- 武器1 -->
<div class="roulette" id="weapon1Roulette">
  <h3>武器①</h3>
  <label><input type="checkbox" id="weapon1On" checked> 有効</label>
  <label><input type="checkbox" id="weapon1FixedCheck"> 固定化</label>
  <select id="weapon1FixedSelect" disabled></select>
  <div class="filters">
    <label><input type="checkbox" id="weapon1Hard"> 難易度アップ</label>
    <span>武器種:</span>
    <label><input type="checkbox" value="AR" class="weapon1Type">AR</label>
    <label><input type="checkbox" value="SMG" class="weapon1Type">SMG</label>
    <label><input type="checkbox" value="LMG" class="weapon1Type">LMG</label>
    <label><input type="checkbox" value="HG" class="weapon1Type">HG</label>
    <label><input type="checkbox" value="SG" class="weapon1Type">SG</label>
    <label><input type="checkbox" value="SR" class="weapon1Type">SR</label>
    <label><input type="checkbox" value="MR" class="weapon1Type">MR</label>
    <span>弾種:</span>
    <label><input type="checkbox" value="ライト" class="weapon1Ammo">ライト</label>
    <label><input type="checkbox" value="ヘビー" class="weapon1Ammo">ヘビー</label>
    <label><input type="checkbox" value="エネルギー" class="weapon1Ammo">エネルギー</label>
    <label><input type="checkbox" value="スナイパー" class="weapon1Ammo">スナイパー</label>
    <label><input type="checkbox" value="特殊" class="weapon1Ammo">特殊</label>
  </div>
  <div class="result" id="weapon1Result">-</div>
  <img id="weapon1Image" src="" alt="">
</div>

<!-- 武器2 -->
<div class="roulette" id="weapon2Roulette">
  <h3>武器②</h3>
  <label><input type="checkbox" id="weapon2On" checked> 有効</label>
  <label><input type="checkbox" id="weapon2FixedCheck"> 固定化</label>
  <select id="weapon2FixedSelect" disabled></select>
  <div class="filters">
    <label><input type="checkbox" id="weapon2Hard"> 難易度アップ</label>
    <span>武器種:</span>
    <label><input type="checkbox" value="AR" class="weapon2Type">AR</label>
    <label><input type="checkbox" value="SMG" class="weapon2Type">SMG</label>
    <label><input type="checkbox" value="LMG" class="weapon2Type">LMG</label>
    <label><input type="checkbox" value="HG" class="weapon2Type">HG</label>
    <label><input type="checkbox" value="SG" class="weapon2Type">SG</label>
    <label><input type="checkbox" value="SR" class="weapon2Type">SR</label>
    <label><input type="checkbox" value="MR" class="weapon2Type">MR</label>
    <span>弾種:</span>
    <label><input type="checkbox" value="ライト" class="weapon2Ammo">ライト</label>
    <label><input type="checkbox" value="ヘビー" class="weapon2Ammo">ヘビー</label>
    <label><input type="checkbox" value="エネルギー" class="weapon2Ammo">エネルギー</label>
    <label><input type="checkbox" value="スナイパー" class="weapon2Ammo">スナイパー</label>
    <label><input type="checkbox" value="特殊" class="weapon2Ammo">特殊</label>
  </div>
  <div class="result" id="weapon2Result">-</div>
  <img id="weapon2Image" src="" alt="">
</div>

<!-- 武器3（特定キャラ） -->
<div class="roulette" id="weapon3Roulette" style="display:none;">
  <h3>武器③（特定キャラ）</h3>
  <label><input type="checkbox" id="weapon3On" checked> 有効</label>
  <label><input type="checkbox" id="weapon3FixedCheck"> 固定化</label>
  <select id="weapon3FixedSelect" disabled></select>
  <div class="filters">
    <label><input type="checkbox" id="weapon3Hard"> 難易度アップ</label>
    <span>武器種:</span>
    <label><input type="checkbox" value="AR" class="weapon3Type">AR</label>
    <label><input type="checkbox" value="SMG" class="weapon3Type">SMG</label>
    <label><input type="checkbox" value="LMG" class="weapon3Type">LMG</label>
    <label><input type="checkbox" value="HG" class="weapon3Type">HG</label>
    <label><input type="checkbox" value="SG" class="weapon3Type">SG</label>
    <label><input type="checkbox" value="SR" class="weapon3Type">SR</label>
    <label><input type="checkbox" value="MR" class="weapon3Type">MR</label>
    <span>弾種:</span>
    <label><input type="checkbox" value="ライト" class="weapon3Ammo">ライト</label>
    <label><input type="checkbox" value="ヘビー" class="weapon3Ammo">ヘビー</label>
    <label><input type="checkbox" value="エネルギー" class="weapon3Ammo">エネルギー</label>
    <label><input type="checkbox" value="スナイパー" class="weapon3Ammo">スナイパー</label>
    <label><input type="checkbox" value="特殊" class="weapon3Ammo">特殊</label>
  </div>
  <div class="result" id="weapon3Result">-</div>
  <img id="weapon3Image" src="" alt="">
</div>

<button onclick="rollAll()">全て回す</button>

<script>
class Character {
  constructor(name, gender, role, image){
    this.name = name; this.gender = gender; this.role = role; this.image = image;
  }
}
class Weapon {
  constructor(name, type, ammo, isCarePackage, image){
    this.name=name; this.type=type; this.ammo=ammo; this.isCarePackage=isCarePackage; this.image=image;
  }
}

  // ===== データ =====
  const specialChar = "バリスティック";
  const characters = [
    new Character("バリスティック","男","アサルト","images/wraith.png"),
    new Character("マッドマギー","女","アサルト","images/gibraltar.png"),
    new Character("フューズ","男","アサルト","images/rampart.png"),
    new Character("レヴナント","男","アサルト","images/bangalore.png"),
    new Character("バンガロール","女","アサルト","images/bangalore.png"),

    new Character("レイス","女","スカーミッシャー","images/wraith.png"),
    new Character("オクタン","男","スカーミッシャー","images/gibraltar.png"),
    new Character("パスファインダー","男","スカーミッシャー","images/rampart.png"),
    new Character("ホライゾン","女","スカーミッシャー","images/bangalore.png"),
    new Character("アッシュ","女","スカーミッシャー","images/bangalore.png"),
    new Character("オルター","女","スカーミッシャー","images/bangalore.png"),

    new Character("ブラッドハウンド","女","リコン","images/gibraltar.png"),
    new Character("クリプト","男","リコン","images/rampart.png"),
    new Character("ヴァルキリー","女","リコン","images/bangalore.png"),
    new Character("ヴァンテージ","女","リコン","images/bangalore.png"),
    new Character("シア","男","リコン","images/bangalore.png"),
    new Character("スパロー","男","リコン","images/bangalore.png"),

    new Character("コンジット","女","サポート","images/gibraltar.png"),
    new Character("ジブラルタル","男","サポート","images/rampart.png"),
    new Character("ライフライン","女","サポート","images/bangalore.png"),
    new Character("ローバ","女","サポート","images/bangalore.png"),
    new Character("ミラージュ","男","サポート","images/bangalore.png"),
    new Character("ニューキャッスル","男","サポート","images/bangalore.png"),

    new Character("カタリスト","女","コントロール","images/gibraltar.png"),
    new Character("コースティック","男","コントロール","images/rampart.png"),
    new Character("ランパート","女","コントロール","images/bangalore.png"),
    new Character("ワットソン","女","コントロール","images/bangalore.png"),
  ];
  
  const weapons = [
    new Weapon("R-301","AR","ライト",false,"images/r301.png"),
    new Weapon("R-99","SMG","ライト",false,"images/r99.png"),
    new Weapon("スピットファイア","LMG","ライト",false,"images/r99.png"),
    new Weapon("G7スカウト","MR","ライト",false,"images/r99.png"),
    new Weapon("CAR","SMG","ライト",false,"images/r99.png"),
    new Weapon("オルタネータ","SMG","ライト",false,"images/r99.png"),

    new Weapon("フラットライン","AR","ヘビー",false,"images/vk47.png"),
    new Weapon("CAR","SMG","ヘビー",false,"images/vk47.png"),
    new Weapon("プラウラー","SMG","ヘビー",false,"images/vk47.png"),
    new Weapon("ランページ","LMG","ヘビー",false,"images/vk47.png"),
    new Weapon("30-30リピーター","MR","ヘビー",false,"images/vk47.png"),
    new Weapon("ヘムロック","AR","ヘビー",false,"images/vk47.png"),

    new Weapon("ボルト","SMG","エネルギー",false,"images/vk47.png"),
    new Weapon("RE45","SMG","エネルギー",false,"images/vk47.png"),
    new Weapon("ハボック","AR","エネルギー",false,"images/vk47.png"),
    new Weapon("Lスター","LMG","エネルギー",false,"images/vk47.png"),
    new Weapon("ディボーション","LMG","エネルギー",false,"images/vk47.png"),

    new Weapon("モザンビーク(ソロ)","SG","ショットガン",false,"images/vk47.png"),
    new Weapon("モザンビーク(アキンボ)","SG","ショットガン",false,"images/vk47.png"),
    new Weapon("EVA-8","SG","ショットガン",false,"images/vk47.png"),
    new Weapon("ピースキーパー","SG","ショットガン",false,"images/vk47.png"),
    new Weapon("マスティフ","SG","ショットガン",false,"images/vk47.png"),

    new Weapon("ウィングマン","HG","スナイパー",false,"images/vk47.png"),
    new Weapon("ロングボウ","SR","スナイパー",false,"images/vk47.png"),
    new Weapon("チャージライフル","SR","スナイパー",false,"images/vk47.png"),
    new Weapon("センチネル","SR","スナイパー",false,"images/vk47.png"),

    new Weapon("ボセック","MR","特殊",false,"images/vk47.png"),
    
    new Weapon("トリプルテイク","特殊MR","特殊",true,"images/vk47.png"),
    new Weapon("P2020","特殊HG","特殊",true,"images/vk47.png"),
    new Weapon("クレーバー","特殊SR","特殊",true,"images/kraber.png"),
  ];


// プルダウン初期化
function initSelect(selectId, dataList){
  const select = document.getElementById(selectId);
  dataList.forEach(d=>{
    const option = document.createElement("option");
    option.value = d.name; option.textContent = d.name;
    select.appendChild(option);
  });
}

window.onload = ()=>{
  // 注意書きオーバーレイ処理
  const overlay = document.getElementById('overlay');
  const closeBtn = document.getElementById('closeOverlay');
  const dontShow = document.getElementById('dontShow');

  if(localStorage.getItem('hideOverlay') === 'true'){
    overlay.style.display = 'none';
  }

  closeBtn.onclick = () => {
    if(dontShow.checked) localStorage.setItem('hideOverlay','true');
    overlay.style.display = 'none';
  }

  ["char","weapon1","weapon2","weapon3"].forEach(type=>{
    initSelect(type+"FixedSelect",(type==="char")?characters:weapons);
    document.getElementById(type+"FixedCheck").addEventListener("change",(e)=>{
      document.getElementById(type+"FixedSelect").disabled = !e.target.checked;
    });
  });
};

// 武器絞り込み
function getFilteredWeapons(type){
  let list = weapons.slice();
  const hardBox = document.getElementById(type+"Hard");
  if(hardBox && hardBox.checked){
    weapons.filter(w=>w.isCarePackage).forEach(w=>{
      if(!list.includes(w)) list.push(w);
    });
  }
  const typeFilters = Array.from(document.querySelectorAll("."+type+"Type:checked")).map(i=>i.value);
  const ammoFilters = Array.from(document.querySelectorAll("."+type+"Ammo:checked")).map(i=>i.value);

  if(typeFilters.length>0) list = list.filter(w=>typeFilters.includes(w.type));
  if(ammoFilters.length>0) list = list.filter(w=>ammoFilters.includes(w.ammo));

  if(list.length===0){
    alert(type+"の条件に合致する武器が存在しません。設定を見直してください。");
    return null;
  }
  return list;
}

// 全ルーレットを回す
function rollAll(){
  ["char","weapon1","weapon2","weapon3"].forEach(type=>roll(type));
}

// 単体ルーレット
function roll(type){
  if(!document.getElementById(type+"On").checked) return;
  const fixedCheck = document.getElementById(type+"FixedCheck").checked;
  const fixedSelect = document.getElementById(type+"FixedSelect");
  const resultSpan = document.getElementById(type+"Result");
  const imgEl = document.getElementById(type+"Image");

  let list = (type==="char") ? characters : getFilteredWeapons(type);
  if(list===null) return;

  resultSpan.classList.add("active");
  imgEl.style.display="inline";

  let i=0;
  const anim = setInterval(() => {
    const display = list[i % list.length];
    resultSpan.innerText = display.name;
    imgEl.src = display.image;
    i++;
  }, 100);

  setTimeout(() => {
    clearInterval(anim);
    let finalChoice;
    if(fixedCheck){
      finalChoice = list.find(w => w.name === fixedSelect.value);
    } else {
      finalChoice = list[Math.floor(Math.random()*list.length)];
    }
    resultSpan.innerText = finalChoice.name;
    imgEl.src = finalChoice.image;

    if(type==="char"){
      document.getElementById("weapon3Roulette").style.display = (finalChoice.name===specialChar) ? "block" : "none";
    }

  }, 2000);
}
</script>
</body>
</html>
